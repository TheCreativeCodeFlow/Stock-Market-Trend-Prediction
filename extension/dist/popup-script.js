async function loadStatus(){try{console.log("[AI Trading Co-Pilot] Loading status...");const e=await chrome.runtime.sendMessage({type:"GET_STATUS",payload:null,timestamp:Date.now()});if(console.log("[AI Trading Co-Pilot] Status response:",e),e){const t=document.getElementById("statusBadge");if(t&&(e.demoMode?(t.className="status-badge demo",t.textContent="◐ Demo"):e.connected?(t.className="status-badge connected",t.textContent="● Online"):(t.className="status-badge disconnected",t.textContent="○ Offline")),e.settings){const t=document.getElementById("apiEndpoint"),n=document.getElementById("geminiApiKey"),o=document.getElementById("autoAnalyze"),a=document.getElementById("overlayEnabled"),s=document.getElementById("showConfidence"),d=document.getElementById("showExplanation"),i=document.getElementById("analysisInterval");t&&(t.value=e.settings.apiEndpoint||"http://localhost:8000"),n&&(n.value=e.settings.geminiApiKey||""),o&&(o.checked=!1!==e.settings.autoAnalyze),a&&(a.checked=!1!==e.settings.overlayEnabled),s&&(s.checked=!1!==e.settings.showConfidence),d&&(d.checked=!1!==e.settings.showExplanation),i&&(i.value=e.settings.analysisInterval||60)}e.lastInsight&&showPrediction(e.lastInsight)}}catch(e){console.error("[AI Trading Co-Pilot] Failed to load status:",e)}}function showPrediction(e){const t=document.getElementById("emptyState"),n=document.getElementById("predictionDisplay");t&&t.classList.add("hidden"),n&&n.classList.remove("hidden");const o=e.prediction,a=document.getElementById("directionArrow");a&&(a.className="direction-arrow "+o.direction,a.textContent="bullish"===o.direction?"↑":"bearish"===o.direction?"↓":"→");const s=document.getElementById("directionLabel"),d=document.getElementById("confidenceValue"),i=document.getElementById("predictionTime");s&&(s.textContent=o.direction.toUpperCase()),d&&(d.textContent=o.confidence.toFixed(1)+"% confidence"),i&&(i.textContent=new Date(e.generatedAt).toLocaleTimeString());const l=o.probabilities,c=document.getElementById("bullishBar"),m=document.getElementById("bullishValue"),g=document.getElementById("bearishBar"),u=document.getElementById("bearishValue"),r=document.getElementById("neutralBar"),y=document.getElementById("neutralValue");c&&(c.style.width=l.bullish+"%"),m&&(m.textContent=l.bullish+"%"),g&&(g.style.width=l.bearish+"%"),u&&(u.textContent=l.bearish+"%"),r&&(r.style.width=l.neutral+"%"),y&&(y.textContent=l.neutral+"%");const E=document.getElementById("riskBadge");E&&(E.className="risk-badge risk-"+e.riskLevel,E.textContent=e.riskLevel.toUpperCase()+" RISK");const h=document.getElementById("explanationText");h&&(h.textContent=e.explanation)}async function saveSettings(){const e=document.getElementById("apiEndpoint"),t=document.getElementById("geminiApiKey"),n=document.getElementById("autoAnalyze"),o=document.getElementById("overlayEnabled"),a=document.getElementById("showConfidence"),s=document.getElementById("showExplanation"),d=document.getElementById("analysisInterval"),i={apiEndpoint:e?e.value:"http://localhost:8000",geminiApiKey:t?t.value:"",autoAnalyze:!n||n.checked,overlayEnabled:!o||o.checked,showConfidence:!a||a.checked,showExplanation:!s||s.checked,analysisInterval:d&&parseInt(d.value)||60};try{await chrome.runtime.sendMessage({type:"SETTINGS_UPDATE",payload:i,timestamp:Date.now()}),console.log("[AI Trading Co-Pilot] Settings saved")}catch(e){console.error("[AI Trading Co-Pilot] Failed to save settings:",e)}}document.addEventListener("DOMContentLoaded",function(){console.log("[AI Trading Co-Pilot] Popup script loaded");const e=document.getElementById("statusTab"),t=document.getElementById("settingsTab"),n=document.getElementById("statusPanel"),o=document.getElementById("settingsPanel");e&&e.addEventListener("click",function(){console.log("Switching to Status tab"),e.classList.add("active"),t.classList.remove("active"),n.classList.remove("hidden"),o.classList.add("hidden")}),t&&t.addEventListener("click",function(){console.log("Switching to Settings tab"),t.classList.add("active"),e.classList.remove("active"),o.classList.remove("hidden"),n.classList.add("hidden")}),loadStatus(),document.querySelectorAll(".setting-input, .setting-toggle input").forEach(function(e){e.addEventListener("change",saveSettings)})});